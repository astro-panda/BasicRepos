name: 'BasicRepos Publish'

trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

steps:
- template: pipelines-template.yml

- task: DotNetCoreCLI@2
  condition:  and(eq('${{ variables['Build.SourceBranchName']}}', 'main'), ne('${{ variables['Build.Reason']}}', 'PullRequest'))
  displayName: 'create NuGet package'
  inputs:
    command: pack
    projects: '**/BasicRepos.csproj'
    arguments: '-o $(Build.ArtifactStagingDirectory)'

- task: PublishBuildArtifacts@1
  condition:  and(eq('${{ variables['Build.SourceBranchName']}}', 'main'), ne('${{ variables['Build.Reason']}}', 'PullRequest'))
  displayName: 'Publish Build Artifacts'
  inputs:
    pathToPublish: '$(Build.ArtifactStagingDirectory)' 
    artifactName: 'drop'    

